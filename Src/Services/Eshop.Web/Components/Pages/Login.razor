@page "/login"
@using Eshop.Web.Models
@using Eshop.Web.Services
@using Microsoft.AspNetCore.Components.Forms
@inject ToastService ToastService
@inject NavigationManager Navigation

<PageTitle>تسجيل الدخول - متجر البراء</PageTitle>

<div class="login-container">
  <div class="login-card">
 <div class="login-header">
            <div class="login-icon">
 <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
   <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
      </svg>
   </div>
  <h2>مرحباً بعودتك</h2>
  <p>سجل دخولك للمتابعة</p>
        </div>

        <EditForm Model="@loginModel" OnValidSubmit="@HandleLogin">
        <DataAnnotationsValidator />

    @if (!string.IsNullOrEmpty(errorMessage))
         {
    <div class="alert alert-danger">
<svg class="alert-icon" viewBox="0 0 20 20" fill="currentColor">
 <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
         </svg>
           @errorMessage
         </div>
            }

            <div class="form-group">
     <label for="email">البريد الإلكتروني</label>
         <InputText id="email" type="email" class="form-control" @bind-Value="loginModel.Email" placeholder="أدخل بريدك الإلكتروني" />
             <ValidationMessage For="@(() => loginModel.Email)" />
       </div>

   <div class="form-group">
   <label for="password">كلمة المرور</label>
     <InputText id="password" type="password" class="form-control" @bind-Value="loginModel.Password" placeholder="أدخل كلمة المرور" />
         <ValidationMessage For="@(() => loginModel.Password)" />
            </div>

         <div class="form-options">
        <label class="checkbox-label">
    <InputCheckbox @bind-Value="loginModel.RememberMe" />
     <span>تذكرني</span>
  </label>
       <a href="/forgot-password" class="link">نسيت كلمة المرور؟</a>
         </div>

            <button type="submit" class="btn btn-primary btn-block" disabled="@isLoading">
      @if (isLoading)
     {
       <span class="spinner"></span>
     <span>جاري تسجيل الدخول...</span>
  }
       else
  {
        <span>تسجيل الدخول</span>
     }
          </button>
      </EditForm>

        <div class="login-footer">
          <p>ليس لديك حساب؟ <a href="/register" class="link-primary">سجل الآن</a></p>
        </div>

        <div class="divider">
            <span>أو تابع بواسطة</span>
      </div>

        <div class="social-login">
            <button class="btn btn-social" @onclick="LoginWithGoogle">
 <svg class="social-icon" viewBox="0 0 24 24" fill="currentColor">
           <path d="M12.48 10.92v3.28h7.84c-.24 1.84-.853 3.187-1.787 4.133-1.147 1.147-2.933 2.4-6.053 2.4-4.827 0-8.6-3.893-8.6-8.72s3.773-8.72 8.6-8.72c2.6 0 4.507 1.027 5.907 2.347l2.307-2.307C18.747 1.44 16.133 0 12.48 0 5.867 0 .307 5.387.307 12s5.56 12 12.173 12c3.573 0 6.267-1.173 8.373-3.36 2.16-2.16 2.84-5.213 2.84-7.667 0-.76-.053-1.467-.173-2.053H12.48z"/>
           </svg>
  Google
   </button>
            <button class="btn btn-social" @onclick="LoginWithMicrosoft">
 <svg class="social-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M11.4 24H0V12.6h11.4V24zM24 24H12.6V12.6H24V24zM11.4 11.4H0V0h11.4v11.4zm12.6 0H12.6V0H24v11.4z"/>
      </svg>
         Microsoft
    </button>
     </div>
    </div>
</div>

@code {
    private LoginRequest loginModel = new();
    private bool isLoading = false;
    private string errorMessage = string.Empty;

    private async Task HandleLogin()
    {
  isLoading = true;
      errorMessage = string.Empty;
        
        try
        {
          // Validate input
         if (string.IsNullOrWhiteSpace(loginModel.Email) || string.IsNullOrWhiteSpace(loginModel.Password))
       {
    errorMessage = "الرجاء ملء جميع الحقول";
         ToastService.ShowWarning("الرجاء ملء جميع الحقول");
         return;
    }

    await Task.Delay(1500);
        
   // TODO: Call authentication service
        // For now, show success
        ToastService.ShowSuccess("تم تسجيل الدخول بنجاح!");
            await Task.Delay(500);
    Navigation.NavigateTo("/");
    }
        catch (Exception ex)
        {
 errorMessage = "البريد الإلكتروني أو كلمة المرور غير صحيحة. يرجى المحاولة مرة أخرى.";
            ToastService.ShowError(errorMessage);
     }
  finally
      {
      isLoading = false;
}
    }

    private async Task LoginWithGoogle()
    {
        ToastService.ShowInfo("تسجيل الدخول بواسطة Google قريباً");
        await Task.CompletedTask;
    }

    private async Task LoginWithMicrosoft()
    {
        ToastService.ShowInfo("تسجيل الدخول بواسطة Microsoft قريباً");
        await Task.CompletedTask;
    }
}

<style>
    .login-container {
 min-height: calc(100vh - 80px);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem 1rem;
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
        position: relative;
    }

    .login-container::before {
        content: '';
        position: absolute;
        top: 0;
      left: 0;
      right: 0;
        bottom: 0;
        background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        opacity: 0.3;
    }

    .login-card {
        background: var(--bg-white);
        border-radius: 20px;
        box-shadow: var(--shadow-lg);
      padding: 3rem;
  width: 100%;
    max-width: 480px;
        animation: slideUp 0.5s ease;
        position: relative;
        z-index: 1;
    }

  @@keyframes slideUp {
        from {
   opacity: 0;
      transform: translateY(40px);
   }
      to {
   opacity: 1;
  transform: translateY(0);
        }
    }

    .login-header {
        text-align: center;
   margin-bottom: 2.5rem;
    }

 .login-icon {
      width: 80px;
      height: 80px;
        margin: 0 auto 1.5rem;
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
      border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      box-shadow: var(--shadow-hover);
    }

    .login-icon svg {
        width: 40px;
        height: 40px;
        color: white;
    }

    .login-header h2 {
   margin: 0 0 0.75rem;
        color: var(--text-dark);
        font-size: 2rem;
        font-weight: 800;
    }

    .login-header p {
     margin: 0;
   color: var(--text-medium);
    font-size: 1.05rem;
    }

    .form-group {
  margin-bottom: 1.75rem;
    }

    .form-group label {
 display: block;
        margin-bottom: 0.6rem;
      color: var(--text-dark);
  font-weight: 600;
        font-size: 0.95rem;
    }

    .form-control {
        width: 100%;
    padding: 0.875rem 1.125rem;
        border: 2px solid var(--border-color);
 border-radius: 10px;
        font-size: 1rem;
        transition: all 0.3s;
  background-color: var(--bg-light);
  font-family: 'Cairo', sans-serif;
    }

    .form-control:focus {
        outline: none;
        border-color: var(--primary-color);
        background-color: var(--bg-white);
        box-shadow: 0 0 0 4px rgba(var(--primary-color-rgb), 0.1);
    }

    .form-options {
        display: flex;
        justify-content: space-between;
        align-items: center;
margin-bottom: 1.75rem;
    }

    .checkbox-label {
    display: flex;
        align-items: center;
        gap: 0.6rem;
  font-size: 0.9rem;
  color: var(--text-medium);
        cursor: pointer;
    }

    .checkbox-label input[type="checkbox"] {
        width: 18px;
     height: 18px;
        cursor: pointer;
    }

    .link {
        color: var(--primary-color);
        text-decoration: none;
    font-size: 0.9rem;
   font-weight: 600;
        transition: color 0.2s;
    }

  .link:hover {
        color: var(--primary-hover);
  text-decoration: underline;
    }

    .spinner {
        width: 18px;
        height: 18px;
 border: 3px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
     animation: spin 0.7s linear infinite;
    }

    @@keyframes spin {
        to { transform: rotate(360deg); }
    }

    .alert {
        padding: 1rem 1.25rem;
        border-radius: 12px;
        margin-bottom: 1.75rem;
        display: flex;
   align-items: center;
  gap: 0.75rem;
        font-weight: 500;
    }

    .alert-danger {
      background-color: rgba(var(--danger-color-rgb), 0.1);
        color: var(--danger-color);
        border: 2px solid var(--danger-color);
  }

    .alert-icon {
   width: 24px;
 height: 24px;
   flex-shrink: 0;
    }

    .login-footer {
  text-align: center;
        margin-top: 2.5rem;
        padding-top: 2rem;
        border-top: 2px solid var(--border-color);
    }

    .login-footer p {
    margin: 0;
     color: var(--text-medium);
        font-size: 0.95rem;
    }

    .link-primary {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 700;
    }

    .link-primary:hover {
        color: var(--primary-hover);
        text-decoration: underline;
    }

    .divider {
        position: relative;
  text-align: center;
        margin: 2rem 0;
    }

    .divider::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
    height: 2px;
        background-color: var(--border-color);
    }

    .divider span {
        position: relative;
        background: var(--bg-white);
        padding: 0 1.25rem;
 color: var(--text-light);
        font-size: 0.9rem;
        font-weight: 600;
    }

    .social-login {
        display: flex;
        gap: 1rem;
    }

    .btn-social {
        flex: 1;
        background: var(--bg-white);
        color: var(--text-medium);
        border: 2px solid var(--border-color);
        padding: 0.875rem;
        font-size: 0.95rem;
     font-weight: 600;
    }

    .btn-social:hover {
  background-color: var(--bg-light);
        border-color: var(--primary-color);
        transform: translateY(-2px);
 box-shadow: var(--shadow);
    }

    .social-icon {
        width: 20px;
        height: 20px;
    }

 .validation-message {
        color: var(--danger-color);
        font-size: 0.85rem;
        margin-top: 0.5rem;
        font-weight: 500;
    }

    @@media (max-width: 768px) {
        .login-card {
       padding: 2rem 1.5rem;
    }

        .login-header h2 {
            font-size: 1.75rem;
  }

        .social-login {
      flex-direction: column;
        }
    }
</style>
