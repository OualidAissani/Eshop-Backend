@using Eshop.Web.Models
@using Eshop.Web.Components.Shared

<div class="products-management">
    <div class="section-header">
        <h2>????? ????????</h2>
    <button class="btn btn-primary" @onclick="OpenAddProductModal">
     <span>+</span> ????? ????
        </button>
    </div>

<div class="filters">
        <div class="search-box">
       <span class="search-icon">??</span>
            <input type="text" @bind="searchQuery" @bind:event="oninput" placeholder="???? ?? ????..." />
  </div>
    <select class="filter-select" @bind="filterCategory">
    <option value="">???? ?????????</option>
            <option value="Electronics">??????????</option>
   <option value="Hijabs">????</option>
            <option value="Abayas">??????</option>
<option value="Accessories">?????????</option>
 <option value="Home">????</option>
        </select>
  <select class="filter-select" @bind="filterStock">
 <option value="">???? ???????</option>
  <option value="instock">?????</option>
   <option value="outofstock">??? ?????</option>
   </select>
    </div>

    <div class="table-container">
        <table class="products-table">
       <thead>
          <tr>
       <th>??????</th>
   <th>?????</th>
     <th>???????</th>
         <th>?????</th>
   <th>???????</th>
  <th>????</th>
 <th>?????????</th>
         </tr>
  </thead>
       <tbody>
       @foreach (var product in FilteredProducts)
    {
                <tr>
         <td>
    <img src="@product.ImageUrl" alt="@product.Name" class="product-thumbnail" />
          </td>
    <td>
   <div class="product-name">@product.Name</div>
              <div class="product-description">@(product.Description.Length > 50 ? product.Description.Substring(0, 50) + "..." : product.Description)</div>
     </td>
   <td>@GetArabicCategoryName(product.Category)</td>
   <td class="price">@product.Price.ToString("F2") ?.?</td>
  <td>
    <span class="badge @(product.InStock ? "badge-success" : "badge-danger")">
@(product.InStock ? "?????" : "??? ?????")
    </span>
    </td>
       <td>
     @if (product.IsFeatured)
        {
               <span class="featured-badge">?</span>
           }
            </td>
      <td>
          <div class="action-buttons">
        <button class="btn-icon" @onclick="() => ViewProduct(product)" title="???">???</button>
             <button class="btn-icon" @onclick="() => EditProduct(product)" title="?????">??</button>
       <button class="btn-icon btn-danger" @onclick="() => ConfirmDeleteProduct(product)" title="???">???</button>
          </div>
       </td>
        </tr>
          }
         </tbody>
  </table>
    </div>

 <div class="pagination">
        <button class="btn-page" disabled>??????</button>
<span class="page-info">???? 1 ?? 10</span>
        <button class="btn-page">??????</button>
    </div>
</div>

<Modal IsVisible="@showProductModal" Title="@(isEditMode ? "????? ????" : "????? ????")" Size="large" OnClose="CloseProductModal">
    <Body>
        <div class="modal-form">
    <div class="form-row">
   <div class="form-group">
  <label>??? ??????</label>
    <input type="text" @bind="currentProduct.Name" class="form-control" placeholder="???? ??? ??????" />
     </div>
  <div class="form-group">
      <label>???????</label>
    <select @bind="currentProduct.Category" class="form-control">
    <option value="">???? ???????</option>
  <option value="Electronics">??????????</option>
    <option value="Hijabs">????</option>
       <option value="Abayas">??????</option>
         <option value="Accessories">?????????</option>
     <option value="Home">????</option>
  </select>
        </div>
   </div>

   <div class="form-group">
    <label>?????</label>
    <textarea @bind="currentProduct.Description" class="form-control" rows="3" placeholder="???? ??? ??????"></textarea>
    </div>

   <div class="form-row">
          <div class="form-group">
   <label>????? (?.?)</label>
        <input type="number" @bind="currentProduct.Price" class="form-control" step="0.01" placeholder="0.00" />
  </div>
      <div class="form-group">
       <label>???? ??????</label>
    <input type="text" @bind="currentProduct.ImageUrl" class="form-control" placeholder="https://..." />
     </div>
   </div>

            <div class="form-row">
 <div class="form-group">
        <label class="checkbox-label">
   <input type="checkbox" @bind="currentProduct.InStock" />
    <span>?????</span>
   </label>
      </div>
       <div class="form-group">
       <label class="checkbox-label">
       <input type="checkbox" @bind="currentProduct.IsFeatured" />
         <span>???? ????</span>
        </label>
   </div>
     </div>
        </div>
    </Body>
    <FooterContent>
        <button class="btn btn-secondary" @onclick="CloseProductModal">?????</button>
        <button class="btn btn-primary" @onclick="SaveProduct">
   @(isEditMode ? "?????" : "?????") ??????
        </button>
    </FooterContent>
</Modal>

<ConfirmDialog 
 IsVisible="@showDeleteConfirm" 
    Title="??? ????" 
    Message="@($"?? ??? ????? ?? ??? '{productToDelete?.Name}'? ?? ???? ??????? ?? ??? ???????.")"
    Type="danger"
    ConfirmText="???"
    CancelText="?????"
    OnResult="HandleDeleteConfirm" />

@code {
    private List<Product> products = new()
    {
        new Product { Id = 1, Name = "Laptop Pro", Category = "Electronics", Price = 1299.99m, ImageUrl = "https://via.placeholder.com/100", InStock = true, IsFeatured = true, Description = "High-performance laptop for professionals" },
        new Product { Id = 2, Name = "Wireless Mouse", Category = "Electronics", Price = 29.99m, ImageUrl = "https://via.placeholder.com/100", InStock = true, IsFeatured = false, Description = "Ergonomic wireless mouse" },
        new Product { Id = 3, Name = "T-Shirt", Category = "Clothing", Price = 19.99m, ImageUrl = "https://via.placeholder.com/100", InStock = true, IsFeatured = false, Description = "Comfortable cotton t-shirt" },
        new Product { Id = 4, Name = "Programming Book", Category = "Books", Price = 49.99m, ImageUrl = "https://via.placeholder.com/100", InStock = false, IsFeatured = false, Description = "Learn C# programming" },
        new Product { Id = 5, Name = "Smart Watch", Category = "Electronics", Price = 299.99m, ImageUrl = "https://via.placeholder.com/100", InStock = true, IsFeatured = true, Description = "Feature-rich smartwatch" }
    };

    private string searchQuery = "";
    private string filterCategory = "";
    private string filterStock = "";
    
    private bool showProductModal = false;
    private bool showDeleteConfirm = false;
    private bool isEditMode = false;
    
    private Product currentProduct = new();
    private Product? productToDelete;

    private IEnumerable<Product> FilteredProducts => products
   .Where(p => string.IsNullOrEmpty(searchQuery) || p.Name.Contains(searchQuery, StringComparison.OrdinalIgnoreCase))
        .Where(p => string.IsNullOrEmpty(filterCategory) || p.Category == filterCategory)
 .Where(p => string.IsNullOrEmpty(filterStock) || 
         (filterStock == "instock" && p.InStock) || 
 (filterStock == "outofstock" && !p.InStock));

    private void OpenAddProductModal()
    {
        isEditMode = false;
        currentProduct = new Product();
 showProductModal = true;
    }

    private void EditProduct(Product product)
    {
        isEditMode = true;
   currentProduct = new Product
        {
            Id = product.Id,
         Name = product.Name,
      Category = product.Category,
  Price = product.Price,
         ImageUrl = product.ImageUrl,
            InStock = product.InStock,
         IsFeatured = product.IsFeatured,
            Description = product.Description
        };
     showProductModal = true;
    }

    private void ViewProduct(Product product)
    {
        // TODO: Implement view product details
    }

    private void ConfirmDeleteProduct(Product product)
    {
        productToDelete = product;
        showDeleteConfirm = true;
 }

    private async Task HandleDeleteConfirm(bool confirmed)
    {
        if (confirmed && productToDelete != null)
        {
       // TODO: Call API to delete product
            products.Remove(productToDelete);
     productToDelete = null;
        }
     showDeleteConfirm = false;
    }

    private void SaveProduct()
    {
   if (isEditMode)
        {
       var existingProduct = products.FirstOrDefault(p => p.Id == currentProduct.Id);
            if (existingProduct != null)
  {
     existingProduct.Name = currentProduct.Name;
     existingProduct.Category = currentProduct.Category;
         existingProduct.Price = currentProduct.Price;
          existingProduct.ImageUrl = currentProduct.ImageUrl;
    existingProduct.InStock = currentProduct.InStock;
        existingProduct.IsFeatured = currentProduct.IsFeatured;
    existingProduct.Description = currentProduct.Description;
            }
        }
        else
        {
            currentProduct.Id = products.Max(p => p.Id) + 1;
         products.Add(currentProduct);
        }

        CloseProductModal();
    }

    private void CloseProductModal()
    {
        showProductModal = false;
 currentProduct = new();
    }

    private string GetArabicCategoryName(string category)
    {
        return category switch
   {
     "Electronics" => "??????????",
       "Accessories" => "?????????",
 "Home" => "????",
       "Hijabs" => "????",
  "Abayas" => "??????",
   "Modest Wear" => "????? ??????",
    _ => category
   };
  }
}

<style>
    .products-management {
        animation: fadeIn 0.3s ease;
    }

    .section-header {
      display: flex;
   justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .section-header h2 {
        margin: 0;
     font-size: 1.5rem;
        font-weight: 600;
        color: #333;
    }

    .filters {
   display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
    }

    .search-box {
        position: relative;
    flex: 1;
        min-width: 250px;
    }

    .search-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
 font-size: 1.25rem;
    }

    .search-box input {
      width: 100%;
  padding: 0.75rem 1rem 0.75rem 3rem;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1rem;
    }

    .search-box input:focus {
        outline: none;
        border-color: #667eea;
    }

  .filter-select {
        padding: 0.75rem 1rem;
        border: 2px solid #e0e0e0;
    border-radius: 8px;
        font-size: 1rem;
        cursor: pointer;
    }

    .table-container {
    background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        overflow: hidden;
 margin-bottom: 1.5rem;
    }

    .products-table {
        width: 100%;
        border-collapse: collapse;
    }

    .products-table thead {
background-color: #f8f9fa;
    }

    .products-table th {
        padding: 1rem;
    text-align: left;
        font-weight: 600;
        color: #333;
        font-size: 0.875rem;
     border-bottom: 2px solid #e0e0e0;
  }

    .products-table td {
      padding: 1rem;
        border-bottom: 1px solid #e0e0e0;
        color: #666;
        font-size: 0.875rem;
    }

    .products-table tbody tr:hover {
        background-color: #f8f9fa;
    }

    .product-thumbnail {
        width: 60px;
   height: 60px;
        object-fit: cover;
        border-radius: 8px;
    }

    .product-name {
    font-weight: 600;
        color: #333;
     margin-bottom: 0.25rem;
    }

    .product-description {
     font-size: 0.75rem;
        color: #999;
    }

    .price {
        font-weight: 600;
  color: #28a745;
    }

    .featured-badge {
  font-size: 1.25rem;
    }

    .action-buttons {
        display: flex;
      gap: 0.25rem;
    }

    .btn-icon {
   background: none;
        border: none;
        padding: 0.5rem;
        font-size: 1.25rem;
        cursor: pointer;
        border-radius: 4px;
        transition: background-color 0.2s;
    }

    .btn-icon:hover {
   background-color: #e9ecef;
    }

    .btn-icon.btn-danger:hover {
        background-color: #f8d7da;
    }

    .pagination {
        display: flex;
        justify-content: center;
  align-items: center;
   gap: 1rem;
    }

    .btn-page {
        padding: 0.5rem 1rem;
     border: 1px solid #e0e0e0;
   background: white;
        border-radius: 6px;
        cursor: pointer;
    transition: all 0.2s;
    }

    .btn-page:hover:not(:disabled) {
   background-color: #667eea;
        color: white;
        border-color: #667eea;
    }

    .btn-page:disabled {
        opacity: 0.5;
   cursor: not-allowed;
    }

    .page-info {
        color: #666;
        font-size: 0.875rem;
    }

    .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-primary {
        background-color: #667eea;
        color: white;
}

    .btn-primary:hover {
  background-color: #5568d3;
 transform: translateY(-1px);
    }

    .btn-secondary {
     background-color: #6c757d;
        color: white;
    }

    .btn-secondary:hover {
        background-color: #5a6268;
    }

    .badge {
  padding: 0.25rem 0.75rem;
   border-radius: 12px;
 font-size: 0.75rem;
        font-weight: 600;
     display: inline-block;
    }

    .badge-success {
        background-color: #d4edda;
        color: #155724;
    }

    .badge-danger {
        background-color: #f8d7da;
        color: #721c24;
    }

    .modal-form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .form-row {
 display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .form-group {
        display: flex;
        flex-direction: column;
    gap: 0.5rem;
    }

    .form-group label {
 font-weight: 500;
        color: #333;
     font-size: 0.875rem;
    }

    .form-control {
padding: 0.75rem;
        border: 2px solid #e0e0e0;
    border-radius: 8px;
        font-size: 1rem;
    }

    .form-control:focus {
 outline: none;
        border-color: #667eea;
    }

    .checkbox-label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
    }

    @@media (max-width: 768px) {
      .filters {
            flex-direction: column;
        }

        .search-box {
            width: 100%;
        }

        .form-row {
     grid-template-columns: 1fr;
        }

      .table-container {
       overflow-x: auto;
        }

 .products-table {
            min-width: 800px;
        }
    }
</style>
