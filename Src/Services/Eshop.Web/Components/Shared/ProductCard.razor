@using Eshop.Web.Models

<div class="product-card" @onclick="OnClick">
    <div class="product-image">
        <img src="@Product.ImageUrl" alt="@Product.Name" />
        @if (Product.IsFeatured)
        {
          <span class="badge-featured">Featured</span>
      }
        @if (!Product.InStock)
        {
        <span class="badge-out-of-stock">Out of Stock</span>
        }
    </div>
    <div class="product-info">
   @if (ShowCategory)
        {
 <span class="product-category">@Product.Category</span>
     }
        <h3 class="product-name">@Product.Name</h3>
    <div class="product-rating">
            <span class="stars">@GetStars(Product.Rating)</span>
    <span class="review-count">(@Product.ReviewCount)</span>
        </div>
        <p class="product-description">@Product.Description</p>
        <div class="product-footer">
 <span class="product-price">$@Product.Price.ToString("F2")</span>
            @if (ShowAddToCart)
     {
        <button class="btn btn-primary btn-sm" 
@onclick:stopPropagation="true" 
    @onclick="OnAddToCart"
              disabled="@(!Product.InStock)">
     @(Product.InStock ? "Add to Cart" : "Out of Stock")
 </button>
      }
        </div>
    </div>
</div>

@code {
    [Parameter]
    public Product Product { get; set; } = new();

    [Parameter]
    public bool ShowCategory { get; set; } = false;

    [Parameter]
    public bool ShowAddToCart { get; set; } = true;

    [Parameter]
    public EventCallback<Product> OnCardClick { get; set; }

    [Parameter]
    public EventCallback<Product> OnAddToCartClick { get; set; }

    private async Task OnClick()
    {
        await OnCardClick.InvokeAsync(Product);
    }

    private async Task OnAddToCart()
    {
        await OnAddToCartClick.InvokeAsync(Product);
  }

 private string GetStars(double rating)
    {
        var fullStars = (int)rating;
        var hasHalfStar = rating % 1 >= 0.5;
        var emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);

        return new string('?', fullStars) + 
         (hasHalfStar ? "?" : "") + 
               new string('?', emptyStars);
    }
}
